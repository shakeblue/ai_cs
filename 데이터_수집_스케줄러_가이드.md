# ë°ì´í„° ìˆ˜ì§‘ ìŠ¤ì¼€ì¤„ëŸ¬ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ë„¤ì´ë²„ ì‡¼í•‘ë¼ì´ë¸Œì˜ ì„¤í™”ìˆ˜ ë° ê¸°íƒ€ ë¸Œëœë“œ ë°ì´í„°ë¥¼ **1ì‹œê°„ë§ˆë‹¤ ìë™ìœ¼ë¡œ ìˆ˜ì§‘**í•˜ëŠ” ë°°ì¹˜ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.

---

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### 1. ìë™ ë°ì´í„° ìˆ˜ì§‘
- â° **ìˆ˜ì§‘ ì£¼ê¸°**: 1ì‹œê°„ë§ˆë‹¤
- ğŸ“¦ **ìˆ˜ì§‘ ëŒ€ìƒ**: ì„¤í™”ìˆ˜ ë¸Œëœë“œ (ê¸°ë³¸)
- ğŸ”„ **ìë™ ì¬ì‹œë„**: ì‹¤íŒ¨ ì‹œ ë‹¤ìŒ ì‹œê°„ì— ì¬ì‹œë„
- ğŸ“Š **ìˆ˜ì§‘ í†µê³„**: ì„±ê³µ/ì‹¤íŒ¨ íšŸìˆ˜ ì¶”ì 

### 2. ë¡œê¹… ì‹œìŠ¤í…œ
- ğŸ“ **ì‹¤í–‰ ë¡œê·¸**: `logs/scheduler_YYYYMMDD.log`
- ğŸ“Š **ìˆ˜ì§‘ í†µê³„**: `output/scheduler_stats.json`
- âš ï¸ **ì—ëŸ¬ ë¡œê·¸**: ì‹¤íŒ¨ ì‹œ ìƒì„¸ ì—ëŸ¬ ê¸°ë¡

### 3. ëª¨ë‹ˆí„°ë§
- âœ… ì„±ê³µ/ì‹¤íŒ¨ íšŸìˆ˜ ì¶”ì 
- ğŸ• ë§ˆì§€ë§‰ ì‹¤í–‰ ì‹œê°„ ê¸°ë¡
- âŒ ì—ëŸ¬ ë©”ì‹œì§€ ì €ì¥

---

## ğŸš€ ì„¤ì¹˜ ë°©ë²•

### 1. í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜

```bash
cd "/Users/amore/ai_cs ì‹œìŠ¤í…œ/crawler"

# schedule íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip3 install schedule

# ë˜ëŠ” requirements.txtì— ì¶”ê°€
echo "schedule==1.2.0" >> requirements.txt
pip3 install -r requirements.txt
```

### 2. íŒŒì¼ êµ¬ì¡° í™•ì¸

```
crawler/
â”œâ”€â”€ scheduler.py                    # ìŠ¤ì¼€ì¤„ëŸ¬ ë©”ì¸ í”„ë¡œê·¸ë¨
â”œâ”€â”€ start_scheduler.sh              # ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ com.amore.datacollector.plist   # macOS launchd ì„¤ì •
â”œâ”€â”€ data-collector.service          # Linux systemd ì„¤ì •
â”œâ”€â”€ logs/                           # ë¡œê·¸ ë””ë ‰í† ë¦¬
â”‚   â”œâ”€â”€ scheduler_YYYYMMDD.log     # ì‹¤í–‰ ë¡œê·¸
â”‚   â”œâ”€â”€ service.log                # ì„œë¹„ìŠ¤ ë¡œê·¸
â”‚   â””â”€â”€ service_error.log          # ì„œë¹„ìŠ¤ ì—ëŸ¬ ë¡œê·¸
â””â”€â”€ output/                         # ì¶œë ¥ ë””ë ‰í† ë¦¬
    â”œâ”€â”€ scheduler_stats.json       # ìˆ˜ì§‘ í†µê³„
    â””â”€â”€ sulwhasoo_lives_*.json     # ìˆ˜ì§‘ëœ ë°ì´í„°
```

---

## â–¶ï¸ ì‹¤í–‰ ë°©ë²•

### ë°©ë²• 1: ì§ì ‘ ì‹¤í–‰ (ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©)

```bash
cd "/Users/amore/ai_cs ì‹œìŠ¤í…œ/crawler"

# Pythonìœ¼ë¡œ ì§ì ‘ ì‹¤í–‰
python3 scheduler.py
```

**íŠ¹ì§•**:
- í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰
- Ctrl+Cë¡œ ì¢…ë£Œ ê°€ëŠ¥
- ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸ ê°€ëŠ¥

---

### ë°©ë²• 2: ì‰˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```bash
cd "/Users/amore/ai_cs ì‹œìŠ¤í…œ/crawler"

# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
./start_scheduler.sh
```

**íŠ¹ì§•**:
- í•„ìš”í•œ íŒ¨í‚¤ì§€ ìë™ í™•ì¸
- ê°€ìƒí™˜ê²½ ìë™ í™œì„±í™”
- ê°„í¸í•œ ì‹¤í–‰

---

### ë°©ë²• 3: ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰

```bash
cd "/Users/amore/ai_cs ì‹œìŠ¤í…œ/crawler"

# ë°±ê·¸ë¼ìš´ë“œë¡œ ì‹¤í–‰
nohup python3 scheduler.py > logs/nohup.log 2>&1 &

# í”„ë¡œì„¸ìŠ¤ ID ì €ì¥
echo $! > scheduler.pid

# í”„ë¡œì„¸ìŠ¤ í™•ì¸
ps aux | grep scheduler.py

# ì¢…ë£Œ
kill $(cat scheduler.pid)
```

**íŠ¹ì§•**:
- í„°ë¯¸ë„ ì¢…ë£Œ í›„ì—ë„ ê³„ì† ì‹¤í–‰
- PID íŒŒì¼ë¡œ í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬

---

### ë°©ë²• 4: macOS launchdë¡œ ì„œë¹„ìŠ¤ ë“±ë¡ (ê¶Œì¥)

```bash
cd "/Users/amore/ai_cs ì‹œìŠ¤í…œ/crawler"

# 1. plist íŒŒì¼ì„ LaunchAgentsì— ë³µì‚¬
cp com.amore.datacollector.plist ~/Library/LaunchAgents/

# 2. ì„œë¹„ìŠ¤ ë¡œë“œ
launchctl load ~/Library/LaunchAgents/com.amore.datacollector.plist

# 3. ì„œë¹„ìŠ¤ ì‹œì‘
launchctl start com.amore.datacollector

# 4. ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
launchctl list | grep datacollector

# 5. ë¡œê·¸ í™•ì¸
tail -f logs/service.log
```

**ì œì–´ ëª…ë ¹**:
```bash
# ì„œë¹„ìŠ¤ ì¤‘ì§€
launchctl stop com.amore.datacollector

# ì„œë¹„ìŠ¤ ì–¸ë¡œë“œ
launchctl unload ~/Library/LaunchAgents/com.amore.datacollector.plist

# ì„œë¹„ìŠ¤ ì¬ì‹œì‘
launchctl unload ~/Library/LaunchAgents/com.amore.datacollector.plist
launchctl load ~/Library/LaunchAgents/com.amore.datacollector.plist
```

**íŠ¹ì§•**:
- âœ… ì‹œìŠ¤í…œ ë¶€íŒ… ì‹œ ìë™ ì‹œì‘
- âœ… í¬ë˜ì‹œ ì‹œ ìë™ ì¬ì‹œì‘
- âœ… ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ ìš´ì˜

---

### ë°©ë²• 5: Linux systemdë¡œ ì„œë¹„ìŠ¤ ë“±ë¡

```bash
# 1. ì„œë¹„ìŠ¤ íŒŒì¼ ë³µì‚¬
sudo cp data-collector.service /etc/systemd/system/

# 2. ì„œë¹„ìŠ¤ ë¦¬ë¡œë“œ
sudo systemctl daemon-reload

# 3. ì„œë¹„ìŠ¤ í™œì„±í™” (ë¶€íŒ… ì‹œ ìë™ ì‹œì‘)
sudo systemctl enable data-collector

# 4. ì„œë¹„ìŠ¤ ì‹œì‘
sudo systemctl start data-collector

# 5. ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
sudo systemctl status data-collector

# 6. ë¡œê·¸ í™•ì¸
sudo journalctl -u data-collector -f
```

**ì œì–´ ëª…ë ¹**:
```bash
# ì„œë¹„ìŠ¤ ì¤‘ì§€
sudo systemctl stop data-collector

# ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sudo systemctl restart data-collector

# ì„œë¹„ìŠ¤ ë¹„í™œì„±í™”
sudo systemctl disable data-collector
```

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### 1. ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸

```bash
cd "/Users/amore/ai_cs ì‹œìŠ¤í…œ/crawler"

# ì˜¤ëŠ˜ ë‚ ì§œ ë¡œê·¸ í™•ì¸
tail -f logs/scheduler_$(date +%Y%m%d).log

# ì„œë¹„ìŠ¤ ë¡œê·¸ í™•ì¸
tail -f logs/service.log

# ì—ëŸ¬ ë¡œê·¸ í™•ì¸
tail -f logs/service_error.log
```

### 2. ìˆ˜ì§‘ í†µê³„ í™•ì¸

```bash
cd "/Users/amore/ai_cs ì‹œìŠ¤í…œ/crawler"

# JSON í˜•ì‹ìœ¼ë¡œ ë³´ê¸°
cat output/scheduler_stats.json

# ë³´ê¸° ì¢‹ê²Œ ì¶œë ¥
cat output/scheduler_stats.json | python3 -m json.tool
```

**í†µê³„ ì˜ˆì‹œ**:
```json
{
  "total_runs": 24,
  "successful_runs": 22,
  "failed_runs": 2,
  "last_run": "2025-11-28 15:00:00",
  "last_success": "2025-11-28 15:00:00",
  "last_error": null
}
```

### 3. ìˆ˜ì§‘ëœ ë°ì´í„° í™•ì¸

```bash
cd "/Users/amore/ai_cs ì‹œìŠ¤í…œ/crawler/output"

# ìµœê·¼ ìˆ˜ì§‘ëœ íŒŒì¼ ëª©ë¡
ls -lht sulwhasoo_lives_*.json | head -5

# ìµœì‹  íŒŒì¼ ë‚´ìš© í™•ì¸
cat $(ls -t sulwhasoo_lives_*.json | head -1) | python3 -m json.tool
```

---

## âš™ï¸ ì„¤ì • ë³€ê²½

### 1. ìˆ˜ì§‘ ì£¼ê¸° ë³€ê²½

`scheduler.py` íŒŒì¼ ìˆ˜ì •:

```python
# í˜„ì¬: ë§¤ ì‹œê°„ ì •ê°ì— ì‹¤í–‰
schedule.every().hour.at(":00").do(scheduler.collect_sulwhasoo_data)

# ë³€ê²½ ì˜ˆì‹œ:

# 30ë¶„ë§ˆë‹¤ ì‹¤í–‰
schedule.every(30).minutes.do(scheduler.collect_sulwhasoo_data)

# 2ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰
schedule.every(2).hours.do(scheduler.collect_sulwhasoo_data)

# ë§¤ì¼ íŠ¹ì • ì‹œê°„ì— ì‹¤í–‰
schedule.every().day.at("09:00").do(scheduler.collect_sulwhasoo_data)
schedule.every().day.at("14:00").do(scheduler.collect_sulwhasoo_data)
schedule.every().day.at("18:00").do(scheduler.collect_sulwhasoo_data)

# íŠ¹ì • ìš”ì¼ì— ì‹¤í–‰
schedule.every().monday.at("10:00").do(scheduler.collect_sulwhasoo_data)
schedule.every().friday.at("15:00").do(scheduler.collect_sulwhasoo_data)
```

### 2. ìˆ˜ì§‘ ëŒ€ìƒ ë³€ê²½

```python
# í˜„ì¬: ì„¤í™”ìˆ˜ë§Œ ìˆ˜ì§‘
schedule.every().hour.at(":00").do(scheduler.collect_sulwhasoo_data)

# ë³€ê²½: ì „ì²´ ë¸Œëœë“œ ìˆ˜ì§‘
schedule.every().hour.at(":00").do(scheduler.collect_all_brands_data)

# ë˜ëŠ” ë‘˜ ë‹¤ ìˆ˜ì§‘
schedule.every().hour.at(":00").do(scheduler.collect_sulwhasoo_data)
schedule.every().hour.at(":30").do(scheduler.collect_all_brands_data)
```

### 3. íƒ€ì„ì•„ì›ƒ ì‹œê°„ ë³€ê²½

```python
# í˜„ì¬: 10ë¶„ íƒ€ì„ì•„ì›ƒ
_v_result = subprocess.run(
    ['python3', str(_v_script)],
    timeout=600  # ì´ˆ ë‹¨ìœ„
)

# ë³€ê²½: 20ë¶„ íƒ€ì„ì•„ì›ƒ
_v_result = subprocess.run(
    ['python3', str(_v_script)],
    timeout=1200  # 20ë¶„ = 1200ì´ˆ
)
```

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### 1. ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•„ìš”

```bash
# Python ë²„ì „ í™•ì¸
python3 --version

# schedule íŒ¨í‚¤ì§€ í™•ì¸
python3 -c "import schedule; print('OK')"

# ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ë‹¤ë©´
pip3 install schedule
```

### 2. í¬ë¡¤ëŸ¬ê°€ ì‹¤íŒ¨í•´ìš”

```bash
# ì—ëŸ¬ ë¡œê·¸ í™•ì¸
tail -50 logs/scheduler_$(date +%Y%m%d).log

# í¬ë¡¤ëŸ¬ ìŠ¤í¬ë¦½íŠ¸ ì§ì ‘ ì‹¤í–‰í•´ë³´ê¸°
cd "/Users/amore/ai_cs ì‹œìŠ¤í…œ/crawler"
python3 parsers/naver_sulwhasoo_crawler.py
```

### 3. ë¡œê·¸ê°€ ìƒì„±ë˜ì§€ ì•Šì•„ìš”

```bash
# logs ë””ë ‰í† ë¦¬ ê¶Œí•œ í™•ì¸
ls -ld logs/

# ê¶Œí•œì´ ì—†ë‹¤ë©´
chmod 755 logs/
```

### 4. ì„œë¹„ìŠ¤ê°€ ìë™ìœ¼ë¡œ ì¬ì‹œì‘ë˜ì§€ ì•Šì•„ìš”

**macOS launchd**:
```bash
# plist íŒŒì¼ í™•ì¸
plutil ~/Library/LaunchAgents/com.amore.datacollector.plist

# ê¶Œí•œ í™•ì¸
chmod 644 ~/Library/LaunchAgents/com.amore.datacollector.plist

# ì¬ë¡œë“œ
launchctl unload ~/Library/LaunchAgents/com.amore.datacollector.plist
launchctl load ~/Library/LaunchAgents/com.amore.datacollector.plist
```

**Linux systemd**:
```bash
# ì„œë¹„ìŠ¤ íŒŒì¼ ë¬¸ë²• í™•ì¸
systemd-analyze verify /etc/systemd/system/data-collector.service

# ì¬ë¡œë“œ
sudo systemctl daemon-reload
sudo systemctl restart data-collector
```

### 5. ë©”ëª¨ë¦¬ë‚˜ CPU ì‚¬ìš©ëŸ‰ì´ ë†’ì•„ìš”

```bash
# í”„ë¡œì„¸ìŠ¤ í™•ì¸
ps aux | grep scheduler

# ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§
top -p $(pgrep -f scheduler.py)

# macOS
top | grep python
```

**í•´ê²° ë°©ë²•**:
- ìˆ˜ì§‘ ì£¼ê¸°ë¥¼ ëŠ˜ë¦¬ê¸° (1ì‹œê°„ â†’ 2ì‹œê°„)
- íƒ€ì„ì•„ì›ƒ ì‹œê°„ ì¤„ì´ê¸°
- ë™ì‹œ ì‹¤í–‰ ë°©ì§€ (lockfile ì‚¬ìš©)

---

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### 1. ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€

```python
import fcntl

def acquire_lock():
    """ë½ íŒŒì¼ë¡œ ì¤‘ë³µ ì‹¤í–‰ ë°©ì§€"""
    lock_file = '/tmp/scheduler.lock'
    fp = open(lock_file, 'w')
    try:
        fcntl.lockf(fp, fcntl.LOCK_EX | fcntl.LOCK_NB)
        return fp
    except IOError:
        logger.error("ì´ë¯¸ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.")
        sys.exit(1)

# main() í•¨ìˆ˜ ì‹œì‘ ë¶€ë¶„ì— ì¶”ê°€
lock_fp = acquire_lock()
```

### 2. ë¡œê·¸ íŒŒì¼ ë¡œí…Œì´ì…˜

```python
from logging.handlers import RotatingFileHandler

# íŒŒì¼ í¬ê¸° ê¸°ë°˜ ë¡œí…Œì´ì…˜ (10MB, 5ê°œ ë°±ì—…)
handler = RotatingFileHandler(
    log_dir / 'scheduler.log',
    maxBytes=10*1024*1024,
    backupCount=5,
    encoding='utf-8'
)
```

### 3. ì˜¤ë˜ëœ ë°ì´í„° ìë™ ì‚­ì œ

```python
def cleanup_old_files(days=7):
    """7ì¼ ì´ìƒ ëœ íŒŒì¼ ì‚­ì œ"""
    cutoff = datetime.now() - timedelta(days=days)
    for file in self.p_output_dir.glob('sulwhasoo_lives_*.json'):
        if datetime.fromtimestamp(file.stat().st_mtime) < cutoff:
            file.unlink()
            logger.info(f"ì˜¤ë˜ëœ íŒŒì¼ ì‚­ì œ: {file.name}")

# ë§¤ì¼ ìì •ì— ì‹¤í–‰
schedule.every().day.at("00:00").do(cleanup_old_files)
```

---

## ğŸ“ ì•Œë¦¼ ì„¤ì • (ì„ íƒì‚¬í•­)

### 1. ì´ë©”ì¼ ì•Œë¦¼

```python
import smtplib
from email.mime.text import MIMEText

def send_email_alert(subject, message):
    """ì´ë©”ì¼ ì•Œë¦¼ ë°œì†¡"""
    msg = MIMEText(message)
    msg['Subject'] = subject
    msg['From'] = 'scheduler@amore.com'
    msg['To'] = 'admin@amore.com'
    
    try:
        with smtplib.SMTP('smtp.gmail.com', 587) as server:
            server.starttls()
            server.login('your_email@gmail.com', 'your_password')
            server.send_message(msg)
    except Exception as e:
        logger.error(f"ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨: {str(e)}")

# ì‹¤íŒ¨ ì‹œ ì´ë©”ì¼ ë°œì†¡
if _v_result.returncode != 0:
    send_email_alert('í¬ë¡¤ë§ ì‹¤íŒ¨', f'ì—ëŸ¬: {_v_result.stderr}')
```

### 2. Slack ì•Œë¦¼

```python
import requests

def send_slack_alert(message):
    """Slack ì•Œë¦¼ ë°œì†¡"""
    webhook_url = 'https://hooks.slack.com/services/YOUR/WEBHOOK/URL'
    payload = {'text': message}
    
    try:
        requests.post(webhook_url, json=payload)
    except Exception as e:
        logger.error(f"Slack ì•Œë¦¼ ì‹¤íŒ¨: {str(e)}")

# ì‹¤íŒ¨ ì‹œ Slack ì•Œë¦¼
if _v_result.returncode != 0:
    send_slack_alert(f'âŒ í¬ë¡¤ë§ ì‹¤íŒ¨: {_v_result.stderr[:200]}')
```

---

## ğŸ¯ ê¶Œì¥ ìš´ì˜ ë°©ì‹

### ê°œë°œ í™˜ê²½
```bash
# í„°ë¯¸ë„ì—ì„œ ì§ì ‘ ì‹¤í–‰
python3 scheduler.py
```

### í…ŒìŠ¤íŠ¸ í™˜ê²½
```bash
# ë°±ê·¸ë¼ìš´ë“œë¡œ ì‹¤í–‰
nohup python3 scheduler.py > logs/nohup.log 2>&1 &
```

### ìš´ì˜ í™˜ê²½ (macOS)
```bash
# launchd ì„œë¹„ìŠ¤ë¡œ ë“±ë¡
launchctl load ~/Library/LaunchAgents/com.amore.datacollector.plist
```

### ìš´ì˜ í™˜ê²½ (Linux)
```bash
# systemd ì„œë¹„ìŠ¤ë¡œ ë“±ë¡
sudo systemctl enable data-collector
sudo systemctl start data-collector
```

---

## âœ¨ ì™„ì„±!

ì´ì œ **1ì‹œê°„ë§ˆë‹¤ ìë™ìœ¼ë¡œ** ì„¤í™”ìˆ˜ ë¼ì´ë¸Œ ë°©ì†¡ ë°ì´í„°ê°€ ìˆ˜ì§‘ë©ë‹ˆë‹¤! ğŸ‰

### ë¹ ë¥¸ ì‹œì‘

```bash
cd "/Users/amore/ai_cs ì‹œìŠ¤í…œ/crawler"

# 1. íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip3 install schedule

# 2. ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰
python3 scheduler.py
```

### ì„œë¹„ìŠ¤ë¡œ ë“±ë¡ (macOS)

```bash
# 1. plist ë³µì‚¬
cp com.amore.datacollector.plist ~/Library/LaunchAgents/

# 2. ì„œë¹„ìŠ¤ ì‹œì‘
launchctl load ~/Library/LaunchAgents/com.amore.datacollector.plist

# 3. ë¡œê·¸ í™•ì¸
tail -f logs/service.log
```

---

## ğŸ“š ì¶”ê°€ ì°¸ê³ ìë£Œ

- [Python schedule ë¼ì´ë¸ŒëŸ¬ë¦¬](https://schedule.readthedocs.io/)
- [macOS launchd ê°€ì´ë“œ](https://www.launchd.info/)
- [Linux systemd ê°€ì´ë“œ](https://www.freedesktop.org/software/systemd/man/systemd.service.html)

